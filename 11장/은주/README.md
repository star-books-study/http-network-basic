# 제 11장. 웹 공격 기술
## 11.1. 웹 공격 기술
- 프로토콜 자신이 공격 대상이 되는 경우는 거의 없다
- 공격 대상은 HTTP 를 사용하는 서버, 클라이언트, 서버 상에서 동작하는 웹 어플리케이션 등의 리소스이다.

### 11.1.1. HTTP 에는 보안 기능이 없다
- 현재 웹 사이트 대부분은 인증, 세션 관리, 암호화 등의 보안 기능이 필요하지만 HTTP 는 이를 제공하지 않는다
- 그 때문에 웹 어플리케이션에서 인증, 세션 관리 기능 등을 개발자가 설계하고 구현할 필요가 있다
- 제각각 설계하기 때문에 각기 다르게 구현되고, 그 결과 보안 등급이 충분치 못하고 공격자가 악용할 수 있는 취약성과 같은 버그가 있는 상태로 가동되고 있는 웹 어플리케이션이 있다

### 11.1.2. 리퀘스트는 클라이언트에서 변조 가능
- 웹 애플리케이션에 대한 공격은 HTTP 리퀘스트 메시지에 공격 코드를 실어서 실행된다
  - 쿼리, 폼, HTTP 헤더, 쿠키 등을 경유해서 보내진다

### 11.1.3. 웹 애플리케이션에 대한 공격 패턴

#### 서버를 노리는 능동적 공격
- 능동적 공격 : 공격자가 직접 웹 애플리케이션에 액세스해서 공격 코드를 보내는 타입의 공격
  - ex) SQL 인젝션, OS 커맨드 인젝션

#### 유저를 노리는 수동적 공격
- 수동적 공격 : 함정을 이용해 유저에게 공격 코드를 실행시키는 공격
  - 사용자가 함정에 걸리면 유저의 브라우저가 장착된 공격 코드를 포함한 HTTP 리퀘스트를 공격 대상인 웹 애플리케이션에 송신하고 공격 코드 실행
  - ex) 크로스 사이트 스크립팅 (XSS), CSRF (Cross Site Request Forgery)
  - 유저가 처한 환경을 이용한 인트라넷 등에 대한 공격
    - 수동적 공격을 이용하면 인트라넷 같은 인터넷에서 직접 액세스 불가한 네트워크 공격 가능
    - 공격자가 설치한 함정에 유저가 액세스할 수 있는 네트워크라면 인트라넷도 공격 가능

## 11.2. 출력 값의 이스케이프 미비로 인한 취약성
- 클라이언트에서 체크
- 웹 애플리케이션 (서버 측) 에서 체크
  - 입력값 체크
  - 출력값 체크

### 11.2.1. 크로스 사이트 스크립팅
- XSS (Cross-Site Scripting) : 취약성이 있는 웹 사이트를 방문한 사용자의 브라우저에서 **부정한 HTML 태그나 JS 등을 동작시키는 공격**이다.
  - 동적으로 HTML 을 생성하는 부분에서 취약성 발생 가능
- 가짜 입력 폼 등에 의해 유저의 개인 정보 탈취
- 유저의 쿠키 값이 도둑맞거나 피해자가 의도하지 않은 리퀘스트 송신
- 가짜 문장이나 이미지 표시

### 11.2.2 SQL 인젝션
- SQL 인젝션 : 웹 애플리케이션을 이용하고 있는 **DB에 SQL을 부정하게 실행**하는 공격
- 데이터베이스 내의 데이터 부정 열람 및 변조
- 인증 회피
- 데이터베이스 서버를 경유한 프로그램 실행

#### SQL 인젝션은 SQL 문장의 구문을 파괴하는 공격
- 공격자에 의해 개발자가 의도하지 않는 형태로 SQL 문장이 변경되어 구조가 파괴되는 공격이다

### 11.2.3 OS 커맨드 인젝션
- OS 커맨드 인젝션 : 웹 애플리케이션을 경유하여 **OS 명령을 부정하게 실행하는 공격**
  - 쉘을 호출하는 함수가 있는 곳에서 발생할 가능성이 있다
  - OS 상에서 동작하는 다양한 프로그램을 실행할 수 있다

### 11.2.4 HTTP 헤더 인젝션
- HTTP 헤더 인젝션 : 공격자가 **리스폰스 헤더 필드에 개행 문자 등을 삽입함으로써 임의의 리스폰스 헤더 필드나 바디를 추가**하는 수동적 공격
  - 특히 바디를 추가하는 공격을 HTTP 리스폰스 분할 공격이라고 한다

### 11.2.5 메일 헤더 인젝션
- 메일 헤더 인젝션 : 웹 애플리케이션의 메일 송신 기능에 메일 헤더를 부정하게 추가하는 공격
보안이 취약한 웹 사이트를 통해 스팸 메일이나 바이러스 메일을 임의의 주소로 송신한다.

### 11.2.6 디렉터리 접근 공격
- 디렉토리 트래버설 (Directory Traversal) : 비공개 디렉터리의 파일에 대해서 **디렉토리 패스를 가로질러 접근하는 공격**
  - 파일이름을 외부에서 지정하는 처리가 취약할 경우, 상대결로나 절대 경로를 지정함으로써 임의의 파일이나 디렉토리에 액세스가 가능해진다.
  - 웹 서버 상의 파일이 잘못 열람되거나 변조, 삭제될 수 있다

### 11.2.7 리모트 파일 인클루션
- 리모트 파일 인클루션 : 스크립트의 일부를 다른 파일에서 읽어올 때 **공격자가 지정한 외부 서버의 URL 을 파일에서 읽게 함으로써 임의의 스크립트를 동작**시키는 공격

## 11.3. 웹 서버의 설정이나 설계 미비로 인한 취약성
### 11.3.1. 강제 브라우징
- 강제 브라우징 : 웹 서버의 공개 디렉토리에 있는 파일 중에서 공개 의도가 없는 파일이 열람되게 하는 취약성

### 11.3.2. 부적절한 에러 메시지 처리
- 공격자에게 유익한 정보가 웹 애플리케이션의 에러 메시지에 포함된다는 공격성
- 상세한 에러메시지는 공격자가 공격을 하기 위한 힌트가 될 수 있다
- 에러 메시지가 공격 힌트로 이용되지 않도록 하려면 각 시스템의 설정에 의한 상세한 에러 메시지를 제한하거나 커스텀 에러 메시지를 이용한다

### 11.3.3. 오픈 리다이렉트
- 오픈 리다이렉트 : 지정한 임의의 URL로 리다이렉트 하는 기능
- 리다이렉트 되는 곳의 URL에 악의가 있는 웹 사이트가 지정된 경우, 유저가 그 웹사이트로 유도되는 취약성과 연결된다

## 11.4. 세션 관리 미비로 인한 취약성
### 11.4.1. 세션 하이잭
- 세션 하이잭 : 공격자가 어떠한 방법으로 유저의 세션 ID 를 입수해서 악용하는 것으로, 유저로 위장하는 공격

### 11.4.2. 세션 픽세이션
- 세션 픽세이션 : 공격자가 지정한 세션 ID 를 유저에게 강제적으로 사용하게 하는 공격으로 수동적 공격, 세션 고정 공격이라고 한다

#### 세션 어댑션
- PHP나 ASP.NET 등에 존재하는 미지의 세션 ID 를 받아들이는 기능

### 11.4.3. 크로스 사이트 리퀘스트 포저리
- CSRF (Cross-Site Request Forgeries) : 인증된 유저가 의도하지 않은 개인정보나 설정 정보 등을 공격자가 설치해 둔 함정에 의해 어떤 사태를 갱신하는 처리를 강제로 실행시키는 공격, 수동적 공격이다
  
## 11.5. 기타
### 11.5.1. 패스워드 트래킹
- 패스워드를 논리적으로 이끌어내서 인증을 돌파하는 공격

#### 네트워크 경유로 패스워드 시행
- 네트워크 경유로 패스워드 후보를 시험해보는 공격
- 무차별 대입 공격
  - 모든 키의 집합 키 공간, 즉 비밀번호 시스템에서 취할 수 있는 모든 패스워드 후보를 시험해서 인증을 돌파하는 공격
- 사전 공격
  - 사전에 패스워드 후보 (사전) 을 준비해두고 그것을 시험해봄으로써 인증을 돌파하는 공격

#### 암호화된 패스워드를 해독
- 무차별 대입 공격/사전 공격에 의한 유추
  - 패스워드 후보에 같은 해시 함수를 적용해 시험해보면서 해시 값을 만들어 내어 패스워드 유추할 수 있다
- 레인보우 테이블
  - 평문과 그에 대응하는 해시 값으로 구성된 데이터베이스 테이블
  - 레인보우 테이블에서 해시값을 검색해 이에 맞는 평문을 이끌어 낼 수 있다

### 11.5.2. 클릭 재킹
- 클릭 재킹 : 투명한 버튼이나 링크를 함정으로 사용할 웹 페이지에 심어두고, 유저에게 링크를 클릭하게 함으로써 의도하지 않은 콘텐츠에 액세스 시키는 공격
  - UI Redressing 이라고도 한다

### 11.5.3. DoS 공격
- DoS (Denial of Service attack) : 서비스 제공을 정지 상태로 만드는 공격
  - 서비스 정지 공격 또는 서비스 거부 공격이라고 불린다
- 액세스를 집중시킴으로써 부하를 걸어 리소스를 다 소비하게 해 사실상 서비스를 정지 상태로 만든다
- 취약성을 공격해 서비스를 정지시킨다

### 11.5.4. 백도어
- 백도어 : 제한된 기능을 정규 절차를 밟지 않고 이용하기 위해 설치된 뒷문
  - 백도어를 사용하면 본래 정해진 제한을 초과한 기능을 이용하는 것이 가능하다